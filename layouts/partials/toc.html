{{ if .TableOfContents }}
<nav id="toc" class="toc">
    <h3 class="text-lg font-semibold mb-4 text-primary-light dark:text-primary-dark">On this page</h3>
    <div class="toc-content text-sm">
        {{ .TableOfContents }}
    </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const headings = document.querySelectorAll('article h2[id], article h3[id]');
    const tocLinks = document.querySelectorAll('#toc a');
    
    if (headings.length === 0 || tocLinks.length === 0) return;
    
    // Function to set active link
    function setActiveLink(id) {
        tocLinks.forEach(link => link.classList.remove('toc-active'));
        const activeLink = document.querySelector(`#toc a[href="#${id}"]`);
        if (activeLink) {
            activeLink.classList.add('toc-active');
        }
    }
    
    // Set first heading as active by default
    if (headings[0]) {
        setActiveLink(headings[0].getAttribute('id'));
    }
    
    // Add click handlers to TOC links
    tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href && href.startsWith('#')) {
                const id = href.substring(1);
                setActiveLink(id);
            }
        });
    });
    
    // Create intersection observer for scroll tracking
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                setActiveLink(id);
            }
        });
    }, {
        rootMargin: '-100px 0px -66%',
        threshold: 1.0
    });
    
    // Observe all headings
    headings.forEach(heading => observer.observe(heading));
});
</script>
{{ end }}
